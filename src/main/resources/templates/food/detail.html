<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<section class="wrapper style2">
		<div class="container">
			<header class="major">
				<h2>맛집 상세보기
				</h2>
			</header>
		</div>
	</section>
   <div id="main-wrapper" style="margin-top: 130px">
   <div class="container">
      <div class="row aln-center">
        <table class="table">
          <tr>
            <td class="text-center" rowspan="9" width=30%>
             <img th:src="${vo.poster}" style="width:500px;height: 400px"> 
            </td>
            <td colspan="2">
             <h3>[[${vo.name}]]&nbsp;<span style="color: red;">[[${vo.score}]]</span></h3>
            </td> 
          </tr>
          <tr>
            <th width=10%>주소</th>
            <td width="60%" class="aln-left">[[${vo.address}]]</td>
          </tr>
          
          <tr>
            <th width=10%>전화</th>
            <td width="60%" class="aln-left">[[${vo.phone}]]</td>
          </tr>
          
          <tr>
            <th width=10%>음식종류</th>
            <td width="60%" class="aln-left">[[${vo.type}]]</td>
          </tr>
          
          <tr>
            <th width=10%>가격대</th>
            <td width="60%" class="aln-left">[[${vo.price}]]</td>
          </tr>
          
          <tr>
            <th width=10%>주차</th>
            <td width="60%" class="aln-left">[[${vo.parking}]]</td>
          </tr>
          
          <tr>
            <th width=10%>영업시간</th>
            <td width="60%" class="aln-left">[[${vo.time}]]></td>
          </tr>
          
          <tr>
            <th width=10%>테마</th>
            <td width="60%" class="aln-left">[[${vo.theme}]]</td>
          </tr>
          <tr>
           <th width=10%>조회수</th>
           <td width="60%" class="aln-left">
          [[${vo.hit}]]
           </td>
          </tr>
        </table>
        <table class="table">
          <tr>
           <td>
            [[${vo.content}]]
           </td>
          </tr>
          <tr>
           <td class="text-right">
            <a href="javascript:history.back()" class="btn btn-xs btn-default">목록</a>
           </td>
          </tr>
        </table>
      </div>
    <!-- 댓글 -->
    <div class="row aln-text" style="margin-top: 10px; width: 800px">
    <h3 style="padding-left: 0">댓글</h3>
      <table class="table">
         <tr>
            <td>
               <table class="table" v-for="rvo in list">
                  <tr style="background-color: #f5f5f5;">
                     <td class="text-left" width="95%">
                        ((rvo.name))&nbsp;&nbsp;&nbsp;((rvo.dbday))
                     </td>
                     <td class="text-right" width="5%">
                        <span v-if="sessionId===rvo.id" style="display: flex">
                           <button class="btn btn-xs upbtn" :id="'u'+rvo.no" @click="replyUpdateForm(rvo.no)" style="background-color: #f5f5f5; width: 30px">수정</button>
                           <button class="btn btn-xs" @click="replyDelete(rvo.no)" style="background-color: #f5f5f5; width: 30px">삭제</button>
                        </span>
                     </td>
                  </tr>
                  <tr>
                     <td colspan="2" class="text-left">
                        <pre style="white-space: pre-wrap;background-color: white;border: none">((rvo.msg))</pre>
                     </td>
                  </tr>
                  <tr>
                     <td colspan="2">
                        <table class="table ups" style="display:none" :id="'up'+rvo.no">
                         <tr>
                          <td>
                           <textarea style="float: left; width:500px; height:100px" :id="'umsg'+rvo.no">((rvo.msg))</textarea>
                           <button type=button class="btn-primary" style="width: 80px;height: 100px;float: left; background-color: gray" @click="replyUpdate(rvo.no)">댓글수정</button>
                          </td>
                         </tr>
                      </table>
                   </td>
                </tr>
               </table>
            </td>
         </tr>
      </table>
      <table class="table" th:if="${session.id!=null}">
		  <tr>
		    <td style="border-top: none;">
		      <textarea rows="4" cols="40"
		        style="float:left; width:600px; height:100px"
		        v-model="msg" ref="msg" @keyup.enter="insert()"></textarea>
		
		      <button type="button"
		        class="btn-primary"
		        style="float:left; width:80px; height:100px; margin-left:6px; background-color: gray"
		        @click="insert()">댓글쓰기</button>
		    </td>
		  </tr>
		</table>
    </div>
   </div>
   </div>
   <script>
    const commentApp=Vue.createApp({

       data(){
          return {
             list:[],
             cno:'[[${vo.fno}]]',
             sessionId:'[[${sessionId}]]',
             msg:'',
             type:100,
             up:false
          }
       },

       mounted(){

          axios.get('http://localhost/comment/list_vue/',{
             params:{
                cno:this.cno,
                type:this.type
             }
          }).then(response=>{
             console.log(response.data)
             this.list=response.data.list
             this.cno=response.data.cno
             this.type=response.data.type
          })
       },
       methods:{
          insert(){
             if(this.msg==='')
             {
                this.$refs.msg.focus()
                return
             }
             axios.post('http://localhost/comment/insert_vue/',{
                cno:this.cno,
                type:this.type,
                msg:this.msg
             }).then(response=>{
                 console.log(response.data)
                 this.list=response.data.list
                 this.cno=response.data.cno
                 this.type=response.data.type
              })
              this.msg=""
              this.$refs.msg.focus()
          },
          replyDelete(no){
             axios.get('http://localhost/comment/delete_vue/',{
                params:{
                   no:no,
                   cno:this.cno,
                   type:this.type
                }
             }).then(response=>{
                 console.log(response.data)
                 this.list=response.data.list
                 this.cno=response.data.cno
                 this.type=response.data.type
              })
          },
          replyUpdateForm(no) {
        	  $('.ups').hide()
        	  $('.upbtn').text("수정")
        	  if(this.up===false) {
        		  this.up=true
        		  $('#up'+no).show()
        		  $('#u'+no).text("취소")
        	  } else {
        		  this.up=false
        		  $('#up'+no).hide()
        		  $('#u'+no).text("수정")
        	  }
          },
          replyUpdate(no) {
        	  let msg = $('#umsg' + no).val();
        	  if(msg==="") {
        		  $('#umsg'+no).focus()
        		  return
        	  }
        	  
        	  axios.get('http://localhost/comment/update_vue/', {
        		  params:{
        			  no:no,
        			  cno:this.cno,
        			  type:this.type,
        			  msg:msg
        		  }
        	  }).then(response=>{
                  console.log(response.data)
                  this.list=response.data.list
                  this.cno=response.data.cno
                  this.type=response.data.type
                  $('#up'+no).hide()
                  $('#u'+no).text("수정")
               })
          }
       }
    })
    commentApp.config.compilerOptions.delimiters=['((','))']
    commentApp.mount("#main-wrapper")
   </script>
</body>
</html>